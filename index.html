<!DOCTYPE html>
<html lang="es">
<head><script type='text/javascript' src='https://ppl-ai-code-interpreter-files.s3.amazonaws.com/6VhZUsBHWvvCzs-mSEFMLogKtLyhh8aSXDsGuW7Rs1ONAcPGgZBLEy5vyO0B3Mop80nTyUggCuMhsuIOT0xZEIdUZ3e6pF57G0bwXN3JJM6LtwfAUodo3j7FElB-0zx9fcDE_i_vmIvj_Egj21Frv9ZoqSxPkA7bojU5e3MjXVp1zo7f2hG2mKN9STVU6dyg1j4QwN203nwPeMkwtjYw_Um9TZozdFNQQzXk7DsyMi7p6wDch1hH9C--88UsAc_b-Y3ymUlmLNBo-xtnhLn8Wn1j9bAOOfdCYssm1SFRLWkGzr_M6310t1gOz80kGXWvq5eLJBbT3sb7tdLEEiOyArMLnaroangJGiI3VSMt-yBzbNXtCZvmtPTNDGhrZGqIKJAC_BT5DCzpq4lIyTTYrNk6F3Iodx16lcQi79jfsd9KV2FiiU1Gl2THeX9atZqn55UiXBXu7JoGvSB0vSE_JzPL4xCcJxLN0SC8qGwQ44__KldeS05Mu58dv5Lh09MrMCU6gJh4QIpM3QNJ39h-QAhjDEZgyxSDKt3hKZpbWxAZz1vV2yLRNCMmCappppjRAQhbLCKsTqypYnEf9DoW1QBIVSPDzsvV6REq_QD1iXbzmOTiO07rv9q-Rzo-x9rDgHuf-iKZ5h0sScvU255jiS9fnkSvvGK2T1OvKuNQDW52IzVYLAY0oPja-NKeYLXfYpWXRnZDTaCbQlzrmlIbDUUXVCTNQkCZQrSO6FA7F_7_uBpd3L5SGszEhoM1G2rgFNN3ElemxwxLBlbRE-J3UrGhkWU6D1opXJWjTha0J0F2Fv0RqPBVdULIJ2r_wVBi2mXtiZ7Wob_eh97ABdtC_4hp9_kO2-AC3OvKIYtLHLVYFXxmY4HxS477ItSBQfca7-xHRkBXfWy1wQoxAh6BGzx0a6wPJduTLgCaPpHZ2W91NXk6QFcVtQVDw2QYw2SNyCHWMj8B1C8Yilg7f5R2Hmkq9zxLi5jrxhHCZsk_S_3dq654rVsQUqFSfVpYI-AsmNv-AM0OoRmFxCx8hT073qDiE2T47PBNMaFshIU8yDJaYSFsai12WzLXeQVrxk8jgZN2834YpjejkN8O7UY2WH4xVHaWtiiPkjAkiGZSkjNs0wC8i_EXxZexhKISuuM35F6VmDolAAvxZhuPAljf47NaTDsdZFxxOoUhAaK5uFom32Kiu3HwZi2e5BZswbl6pdO_kI8EsAMh-EXYcmOo3rlWhZXHH_gxOQdyHQRA-Qva3CsMK-6VEbBLLODv-iBuxyZ3pkMbVnrmowkDYiVw7HHGNqoTbXLjMmVt2ElIHNgOVYLUu-DG8BTv6dxCukvpaFpdzQl6qAUPT86xLqQfjJXo2nPXEnNGM8TK_dcpM3GXy_pwWgr4h600HW2mPMOaMNPeOqQTWxx3dOjzd-vNllunv8F8KpieXce5DnRZ2_GU5LuBzG5NISEplkUNfpHwOe4COu3BMVFBLcavJDJomKwda3xLqnbHSairnMno11feWjf6d14YwWZk73dI_NOxVD9CjtzPVFe0Aj0bP4bGy7YuSMuDGar0rW1n0vEkG-2qhyzSj43BIr7cn2osDP32dQmUyJ-hrWdBukC47Xz4vebBWaBgIKX5MoSr9oXGzGcyMJOn-9LHPaS8CIr6FossAZ15SkZtsP9TigLJtgOK7L_2NXx5sxmP_1PVbghq-7LZZY2uNBrhzXRbbme_NkCvXBcoUW9AlB2lpKaZjAWL1rkH5tuFCx7LTDt6cRNNh_qJZXEB2UpfMtZZgRw1Nttj7NLRKHbo5LF0wrWtEjv2tV3d6dQM40DpAlX5cMavw9yTYfCsEmUoMt9I0B_ri7Y5J-xTdujkpLMvmk-Bu5GHM_pLaLOcbjytiOITP2_DVF8whxMn991E3CmWYFqlzsMi7dC6WOwJdLgJ4qdchcKsbsIrxd0T0CLQE4qJW-A_NbxobJq8IfAulDxglqVKmqHFD9edYA5_ex1pxIs0xXwHdwQajG-B6mrQvoJmCWLCc_8MW6hK_JymvYUlryNnqRJD9FX7MKaYpTYyVAnDoQvInvxzC97GgjFweSuD-YmUJSFn-SZ6-ustosaBz3dAHm-p3VtZo7FNhJBD3nE5bSxcxNhGWdYkhPrlROuWFi1YGFyCGxAnRtpIzPkYy3dhfsDwVDDRGZVttS_7alDKUaJekBpA2wXookwX7aexi3uOZshM_VlxUco-8INAN1rn3BjDiXDgKNZjOJ22y7vJzMVp_b9_1ThNziGj3MnPZ1xcpPXrdJhQszJNGGXKli0OxrW2Mg1IRwjyMYKYFw1e0YyV2aQ33Gb1vp-o6Fdndasi_dEl6B500Cgs_sYZyADO2oXvVTgIqF486dC7rucjcCCfrYPt6xwZ2AsL9nqmOJv-Iv_jA0CzGmupRNuG73nWIrKvqFH0NhjV_gVYGS9e6FTP8vzgnMiygzbrZ-pYCCCZCjE3ngHkpmbWKKaii1rthc8wPgubQWNuYPI8cZj_cBQnYpsZCiX4ML2AYv434HTExAXtyBrkv_zDIsKiqaZLByGyjwLYohvdigYrL4kxIYWxYJ7hFg8YOu7YDzTmVzgPIizvsVOrOITR5VHDf9QeJJewibVPPW4kP19xfH470i2rbqwRK4g7PZ3_E6NKtQsFy2bdowpvtGW8PewxWYg8h5_8f-xfw6VqQ0snzWqEbGTvuZzzYsw'></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TPV Sociedad - Gesti√≥n de Consumiciones</title>
    <style>
        :root {
            --color-bg-primary: #0f172a;
            --color-bg-secondary: #1e293b;
            --color-bg-elevated: #334155;
            --color-text-primary: #f1f5f9;
            --color-text-secondary: #cbd5e1;
            --color-text-muted: #94a3b8;
            --color-primary: #38bdf8;
            --color-primary-hover: #0ea5e9;
            --color-success: #10b981;
            --color-danger: #ef4444;
            --color-warning: #f59e0b;
            --color-border: rgba(148, 163, 184, 0.2);
        }

        @media (prefers-color-scheme: light) {
            :root {
                --color-bg-primary: #ffffff;
                --color-bg-secondary: #f8fafc;
                --color-bg-elevated: #f1f5f9;
                --color-text-primary: #0f172a;
                --color-text-secondary: #475569;
                --color-text-muted: #64748b;
                --color-border: rgba(15, 23, 42, 0.1);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--color-bg-primary);
            color: var(--color-text-primary);
            padding: 16px;
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 24px;
            padding: 16px;
            background: var(--color-bg-secondary);
            border-radius: 12px;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--color-primary);
        }

        .header p {
            color: var(--color-text-secondary);
            font-size: 14px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .btn {
            width: 100%;
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 12px;
        }

        .btn-primary {
            background: var(--color-primary);
            color: #0f172a;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--color-bg-elevated);
            color: var(--color-text-primary);
            border: 1px solid var(--color-border);
        }

        .btn-secondary:hover {
            background: var(--color-bg-secondary);
        }

        .btn-danger {
            background: var(--color-danger);
            color: white;
        }

        .btn-success {
            background: var(--color-success);
            color: white;
        }

        .btn-warning {
            background: var(--color-warning);
            color: white;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
            width: auto;
            display: inline-block;
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--color-text-secondary);
            font-size: 14px;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            font-size: 16px;
            background: var(--color-bg-secondary);
            color: var(--color-text-primary);
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .card {
            background: var(--color-bg-secondary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid var(--color-border);
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .product-item {
            background: var(--color-bg-elevated);
            border: 2px solid var(--color-border);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .product-item:hover {
            transform: translateY(-2px);
            border-color: var(--color-primary);
        }

        .product-img {
            width: 50px;
            height: 50px;
            margin: 0 auto 8px;
            font-size: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .product-name {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .product-price {
            font-size: 12px;
            color: var(--color-text-muted);
        }

        .order-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--color-bg-elevated);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .order-item-info {
            flex: 1;
        }

        .order-item-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .order-item-price {
            font-size: 14px;
            color: var(--color-text-muted);
        }

        .order-item-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .quantity-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: var(--color-primary);
            color: #0f172a;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quantity {
            font-size: 18px;
            font-weight: 600;
            min-width: 30px;
            text-align: center;
        }

        .total-section {
            background: var(--color-bg-elevated);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .total-label {
            font-size: 14px;
            color: var(--color-text-secondary);
            margin-bottom: 8px;
        }

        .total-amount {
            font-size: 32px;
            font-weight: 700;
            color: var(--color-primary);
        }

        .qr-container {
            text-align: center;
            padding: 20px;
        }

        #qrcode {
            display: inline-block;
            padding: 20px;
            background: white;
            border-radius: 12px;
            margin: 20px 0;
        }

        .session-list {
            margin-bottom: 16px;
        }

        .session-card {
            background: var(--color-bg-elevated);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            border: 2px solid var(--color-border);
            transition: all 0.2s;
        }

        .session-card:hover {
            border-color: var(--color-primary);
        }

        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .session-name {
            font-weight: 600;
            font-size: 16px;
        }

        .session-status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            background: var(--color-success);
            color: white;
        }

        .session-info {
            font-size: 14px;
            color: var(--color-text-secondary);
        }

        .admin-section {
            margin-bottom: 24px;
        }

        .admin-section h3 {
            margin-bottom: 12px;
            color: var(--color-primary);
        }

        .product-form {
            background: var(--color-bg-elevated);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--color-success);
            border: 1px solid var(--color-success);
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--color-danger);
            border: 1px solid var(--color-danger);
        }

        .product-admin-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--color-bg-secondary);
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.2s;
        }

        .product-admin-item:hover {
            background: var(--color-bg-elevated);
        }

        .back-btn {
            margin-bottom: 16px;
        }

        .icon-picker {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin-top: 8px;
            max-height: 200px;
            overflow-y: auto;
            padding: 8px;
            background: var(--color-bg-primary);
            border-radius: 8px;
        }

        .icon-option {
            font-size: 24px;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            border-radius: 4px;
            background: var(--color-bg-secondary);
            border: 2px solid transparent;
        }

        .icon-option:hover, .icon-option.selected {
            border-color: var(--color-primary);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--color-text-muted);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .category-filter {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            margin-bottom: 16px;
            padding-bottom: 8px;
        }

        .category-btn {
            padding: 8px 16px;
            background: var(--color-bg-elevated);
            border: 1px solid var(--color-border);
            border-radius: 20px;
            white-space: nowrap;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .category-btn.active {
            background: var(--color-primary);
            color: #0f172a;
            border-color: var(--color-primary);
        }

        .summary-category {
            background: var(--color-bg-elevated);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .summary-category-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--color-border);
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--color-border);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-item-name {
            font-size: 16px;
            font-weight: 500;
        }

        .summary-item-qty {
            font-size: 20px;
            font-weight: 700;
            color: var(--color-primary);
            min-width: 50px;
            text-align: right;
        }

        @media print {
            body {
                background: white;
                color: black;
            }
            .btn, .back-btn {
                display: none !important;
            }
            .header {
                background: white;
                border: 2px solid black;
            }
        }
    </style>
</head>
<body>
    <!-- Pantalla Principal -->
    <div id="mainScreen" class="screen active">
        <div class="header">
            <h1><img src="https://agi-prod-file-upload-public-main-use1.s3.amazonaws.com/ca45cbb9-685b-43ed-9089-37caa496bf03" alt="Logo Azeri" style="width: 40px; height: 40px; vertical-align: middle; margin-right: 12px; border-radius: 6px;">Azeri Elkartea</h1>
            <p>Gesti√≥n de consumiciones colectivas</p>
        </div>

        <button class="btn btn-primary" onclick="showCreateSession()">‚ûï Nueva Cuenta</button>
        <button class="btn btn-secondary" onclick="showJoinSession()">üì± Unirse con QR</button>
        <button class="btn btn-secondary" onclick="showMySessions()">üìã Mis Cuentas</button>
        <button class="btn btn-secondary" onclick="showAdminLogin()">‚öôÔ∏è Administraci√≥n</button>
    </div>

    <!-- Pantalla Crear Sesi√≥n -->
    <div id="createSessionScreen" class="screen">
        <button class="btn btn-secondary btn-small back-btn" onclick="showMain()">‚Üê Volver</button>
        
        <div class="header">
            <h1>Nueva Cuenta</h1>
            <p>Crea una cuenta para tu grupo</p>
        </div>

        <div class="card">
            <div class="form-group">
                <label for="sessionName">Nombre de la cuenta</label>
                <input type="text" id="sessionName" placeholder="Ej: Mesa de Juan">
            </div>
            <div class="form-group">
                <label for="sessionPin">PIN de seguridad (4 d√≠gitos)</label>
                <input type="number" id="sessionPin" placeholder="Ej: 1234" maxlength="4" pattern="[0-9]{4}">
                <p style="font-size: 12px; color: var(--color-text-muted); margin-top: 4px;">
                    Este PIN se pedir√° a tus invitados al escanear el QR
                </p>
            </div>
            <button class="btn btn-primary" onclick="createSession()">Crear Cuenta</button>
        </div>
    </div>

    <!-- Pantalla QR Compartir -->
    <div id="qrScreen" class="screen">
        <button class="btn btn-secondary btn-small back-btn" onclick="showMain()">‚Üê Volver</button>
        
        <div class="header">
            <h1>Compartir Cuenta</h1>
            <p>Escanea este c√≥digo para unirte</p>
        </div>

        <div class="qr-container">
            <div id="qrcode"></div>
            <p style="color: var(--color-text-secondary); font-size: 14px;">Los invitados pueden escanear este c√≥digo para acceder a la cuenta</p>
            <button class="btn btn-primary" onclick="goToSession()">Ir a mi Cuenta</button>
        </div>
    </div>

    <!-- Pantalla Unirse -->
    <div id="joinScreen" class="screen">
        <button class="btn btn-secondary btn-small back-btn" onclick="showMain()">‚Üê Volver</button>
        
        <div class="header">
            <h1>Unirse a Cuenta</h1>
            <p>Escanea el c√≥digo QR del socio</p>
        </div>

        <div class="card">
            <div id="joinError"></div>
            <div class="form-group">
                <label for="sessionId">C√≥digo de la cuenta</label>
                <input type="text" id="sessionId" placeholder="C√≥digo de 6 d√≠gitos">
            </div>
            <div class="form-group">
                <label for="joinPin">PIN de seguridad</label>
                <input type="number" id="joinPin" placeholder="PIN de 4 d√≠gitos" maxlength="4" pattern="[0-9]{4}">
            </div>
            <button class="btn btn-primary" onclick="joinSession()">Unirse</button>
        </div>
    </div>

    <!-- Pantalla Sesi√≥n Activa (TPV) -->
    <div id="sessionScreen" class="screen">
        <button class="btn btn-secondary btn-small back-btn" onclick="leaveSession()">‚Üê Salir</button>
        
        <div class="header">
            <h1 id="sessionTitle"><img src="https://agi-prod-file-upload-public-main-use1.s3.amazonaws.com/ca45cbb9-685b-43ed-9089-37caa496bf03" alt="Logo Azeri" style="width: 40px; height: 40px; vertical-align: middle; margin-right: 12px; border-radius: 6px;">Mi Cuenta</h1>
            <p id="sessionCode"></p>
        </div>

        <div style="display: flex; gap: 8px; margin-bottom: 16px;">
            <button class="btn btn-secondary btn-small" onclick="showShareQR()" style="flex: 1;">üì§ Compartir QR</button>
            <button class="btn btn-warning btn-small" onclick="showSummary()" style="flex: 1;">üìä Resumen TPV</button>
        </div>

        <div class="category-filter" id="categoryFilter">
            <div class="category-btn active" onclick="filterByCategory('all')">Todos</div>
        </div>

        <div class="product-grid" id="productGrid"></div>

        <div class="card">
            <h3 style="margin-bottom: 12px; color: var(--color-primary);">üìù Pedido Actual</h3>
            <div class="order-list" id="orderList">
                <div class="empty-state">
                    <div class="empty-state-icon">üõí</div>
                    <p>No hay productos en el pedido</p>
                </div>
            </div>
        </div>

        <div class="total-section">
            <div class="total-label">Total de productos</div>
            <div class="total-amount" id="totalAmount">0</div>
        </div>

        <button class="btn btn-danger" onclick="closeSession()">üîí Cerrar Cuenta</button>
    </div>

    <!-- Pantalla Resumen TPV -->
    <div id="summaryScreen" class="screen">
        <button class="btn btn-secondary btn-small back-btn" onclick="backToSession()">‚Üê Volver</button>
        
        <div class="header">
            <h1>üìä Resumen para TPV</h1>
            <p id="summarySessionName"></p>
        </div>

        <div id="summaryContent"></div>

        <div class="total-section">
            <div class="total-label">Total General</div>
            <div class="total-amount" id="summaryTotal">0</div>
        </div>

        <button class="btn btn-primary" onclick="printSummary()">üñ®Ô∏è Imprimir Resumen</button>
        <button class="btn btn-secondary" onclick="backToSession()">Volver a la Cuenta</button>
    </div>

    <!-- Pantalla Mis Sesiones -->
    <div id="mySessionsScreen" class="screen">
        <button class="btn btn-secondary btn-small back-btn" onclick="showMain()">‚Üê Volver</button>
        
        <div class="header">
            <h1>Mis Cuentas</h1>
            <p>Cuentas activas y recientes</p>
        </div>

        <div class="session-list" id="sessionList"></div>
    </div>

    <!-- Pantalla Login Admin -->
    <div id="adminLoginScreen" class="screen">
        <button class="btn btn-secondary btn-small back-btn" onclick="showMain()">‚Üê Volver</button>
        
        <div class="header">
            <h1>üîê Administraci√≥n</h1>
            <p>Acceso restringido</p>
        </div>

        <div class="card">
            <div id="adminError"></div>
            <div class="form-group">
                <label for="adminPassword">Contrase√±a</label>
                <input type="password" id="adminPassword" placeholder="Introduce la contrase√±a">
            </div>
            <button class="btn btn-primary" onclick="adminLogin()">Acceder</button>
        </div>
    </div>

    <!-- Pantalla Admin -->
    <div id="adminScreen" class="screen">
        <button class="btn btn-secondary btn-small back-btn" onclick="showMain()">‚Üê Salir</button>
        
        <div class="header">
            <h1>‚öôÔ∏è Panel de Administraci√≥n</h1>
            <p>Gesti√≥n de productos</p>
        </div>

        <div class="admin-section">
            <h3>üì§ Importar Productos desde Excel</h3>
            <div class="product-form">
                <div id="importSuccess"></div>
                <div class="form-group">
                    <label for="excelFile">Selecciona archivo Excel</label>
                    <input type="file" id="excelFile" accept=".xlsx,.xls" style="padding: 8px;">
                    <p style="font-size: 12px; color: var(--color-text-muted); margin-top: 4px;">
                        El archivo debe tener columnas: "Nombre" y "Familia"
                    </p>
                </div>
                <button class="btn btn-primary" onclick="importExcel()">Importar Productos</button>
            </div>
        </div>

        <div class="admin-section">
            <h3>‚ûï A√±adir Producto Manual</h3>
            <div class="product-form">
                <div id="productSuccess"></div>
                <div class="form-group">
                    <label for="productName">Nombre del producto</label>
                    <input type="text" id="productName" placeholder="Ej: Cerveza">
                </div>
                <div class="form-group">
                    <label for="productPrice">Precio (‚Ç¨)</label>
                    <input type="number" id="productPrice" placeholder="2.50" step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label for="productCategory">Categor√≠a</label>
                    <input type="text" id="productCategory" placeholder="Ej: Bebidas">
                </div>
                <div class="form-group">
                    <label>Icono del producto</label>
                    <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                        <button type="button" class="btn btn-secondary btn-small" onclick="showEmojiPicker()">üòä Emoji</button>
                        <button type="button" class="btn btn-secondary btn-small" onclick="showImageUpload()">üñºÔ∏è Imagen</button>
                    </div>
                    <div id="selectedIcon" style="font-size: 48px; text-align: center; margin: 12px 0;">üç∫</div>
                    <div id="iconPickerContainer" style="display: block;">
                        <div class="icon-picker" id="iconPicker"></div>
                    </div>
                    <div id="imageUploadContainer" style="display: none;">
                        <input type="file" id="imageUpload" accept="image/*" style="padding: 8px; margin-bottom: 8px;">
                        <p style="font-size: 12px; color: var(--color-text-muted);">
                            Formatos: JPG, PNG, GIF. Tama√±o recomendado: 100x100px
                        </p>
                    </div>
                </div>
                <button class="btn btn-success" onclick="addProduct()">Guardar Producto</button>
            </div>
        </div>

        <div class="admin-section">
            <h3>üì¶ Productos Actuales</h3>
            <div id="productAdminList"></div>
        </div>

        <div class="admin-section">
            <h3>üîë Cambiar Contrase√±a</h3>
            <div class="product-form">
                <div id="passwordSuccess"></div>
                <div class="form-group">
                    <label for="newPassword">Nueva contrase√±a</label>
                    <input type="password" id="newPassword" placeholder="M√≠nimo 6 caracteres">
                </div>
                <button class="btn btn-primary" onclick="changePassword()">Actualizar Contrase√±a</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // Datos de la aplicaci√≥n con persistencia real
        const appData = {
            products: [],
            sessions: {},
            currentSession: null,
            adminPassword: 'admin123'
        };

        // Funci√≥n para guardar sesiones en localStorage
        function saveSessions() {
            try {
                localStorage.setItem('azeri_sessions', JSON.stringify(appData.sessions));
                console.log('‚úÖ Sesiones guardadas:', Object.keys(appData.sessions).length);
            } catch (error) {
                console.error('‚ùå Error al guardar sesiones:', error);
            }
        }

        // Funci√≥n para cargar sesiones desde localStorage
        function loadSessions() {
            try {
                const savedSessions = localStorage.getItem('azeri_sessions');
                if (savedSessions) {
                    appData.sessions = JSON.parse(savedSessions);
                    console.log('‚úÖ Sesiones cargadas:', Object.keys(appData.sessions).length);
                }
            } catch (error) {
                console.error('‚ùå Error al cargar sesiones:', error);
                appData.sessions = {};
            }
        }

        const icons = ['üç∫', 'üç∑', 'ü•§', 'üíß', '‚òï', 'üßÉ', 'ü•õ', 'üçæ', 'ü•î', 'ü´í', 'ü•ì', 'üßÄ', 'üçñ', 'üçó', 'ü•©', 'üçû', 'ü•ñ', 'ü•ê', 'ü•®', 'ü•Ø', 'üçï', 'üå≠', 'üçî', 'üçü', 'üåÆ', 'üåØ', 'ü•ô', 'üßÜ', 'ü•ö', 'üç≥', 'üßà', 'üç™', 'üç©', 'üç∞', 'üéÇ', 'üßÅ', 'üç´', 'ü•É', 'üç∏', 'üçπ', 'üßä', 'üçµ', 'ü•ó', 'üçù', 'üçú', 'üç≤', 'ü•ò', 'üçõ', 'üç£', 'üç±', 'ü•ü', 'üç§', 'ü¶ê', 'ü¶û', 'ü¶Ä', 'üêü', 'ü•©', 'üçó', 'üå∂Ô∏è', 'üßÑ', 'üßÖ', 'ü•ú', 'üå∞', 'üçá', 'üçä', 'üçã', 'üçå', 'üçâ', 'üçë', 'üçí', 'üçì', 'ü´ê', 'ü•ù'];

        let currentFilter = 'all';

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function showMain() {
            showScreen('mainScreen');
        }

        function showCreateSession() {
            showScreen('createSessionScreen');
            document.getElementById('sessionName').value = '';
        }

        function showJoinSession() {
            showScreen('joinScreen');
            document.getElementById('sessionId').value = '';
        }

        function showMySessions() {
            showScreen('mySessionsScreen');
            renderSessionList();
        }

        function showAdminLogin() {
            showScreen('adminLoginScreen');
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminError').innerHTML = '';
        }

        function generateSessionId() {
            return Math.random().toString(36).substr(2, 6).toUpperCase();
        }

        function createSession() {
            const name = document.getElementById('sessionName').value.trim();
            const pin = document.getElementById('sessionPin').value.trim();
            
            if (!name) {
                alert('Por favor, introduce un nombre para la cuenta');
                return;
            }
            
            if (!pin || pin.length !== 4 || !/^\d{4}$/.test(pin)) {
                alert('Por favor, introduce un PIN de 4 d√≠gitos');
                return;
            }

            const sessionId = generateSessionId();
            appData.sessions[sessionId] = {
                id: sessionId,
                name: name,
                pin: pin,
                createdAt: new Date().toISOString(),
                expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                items: {},
                isActive: true
            };
            appData.currentSession = sessionId;

            // Guardar sesi√≥n en localStorage
            saveSessions();

            showQRScreen(sessionId);
        }

        function showQRScreen(sessionId) {
            showScreen('qrScreen');
            document.getElementById('qrcode').innerHTML = '';
            
            const url = window.location.href.split('?')[0] + '?session=' + sessionId;
            new QRCode(document.getElementById('qrcode'), {
                text: url,
                width: 200,
                height: 200,
                colorDark: '#0f172a',
                colorLight: '#ffffff'
            });
        }

        function showShareQR() {
            if (appData.currentSession) {
                showQRScreen(appData.currentSession);
            }
        }

        function goToSession() {
            if (appData.currentSession) {
                loadSession(appData.currentSession);
            }
        }

        function joinSession() {
            const sessionId = document.getElementById('sessionId').value.trim().toUpperCase();
            const pin = document.getElementById('joinPin').value.trim();
            const errorDiv = document.getElementById('joinError');
            
            if (!sessionId) {
                errorDiv.innerHTML = '<div class="alert alert-error">Por favor, introduce un c√≥digo de sesi√≥n</div>';
                return;
            }
            
            if (!pin) {
                errorDiv.innerHTML = '<div class="alert alert-error">Por favor, introduce el PIN</div>';
                return;
            }

            const session = appData.sessions[sessionId];
            
            if (!session) {
                errorDiv.innerHTML = '<div class="alert alert-error">C√≥digo de sesi√≥n no v√°lido</div>';
                return;
            }
            
            if (session.pin !== pin) {
                errorDiv.innerHTML = '<div class="alert alert-error">PIN incorrecto</div>';
                return;
            }
            
            if (!session.isActive) {
                errorDiv.innerHTML = '<div class="alert alert-error">Esta cuenta ya no est√° activa</div>';
                return;
            }

            appData.currentSession = sessionId;
            loadSession(sessionId);
        }

        function loadSession(sessionId) {
            const session = appData.sessions[sessionId];
            if (!session || !session.isActive) {
                alert('Esta cuenta no est√° activa');
                showMain();
                return;
            }

            appData.currentSession = sessionId;
            
            const sessionHeader = document.querySelector('#sessionScreen .header');
            sessionHeader.innerHTML = `
                <h1 id="sessionTitle"><img src="https://agi-prod-file-upload-public-main-use1.s3.amazonaws.com/ca45cbb9-685b-43ed-9089-37caa496bf03" alt="Logo Azeri" style="width: 40px; height: 40px; vertical-align: middle; margin-right: 12px; border-radius: 6px;">${session.name}</h1>
                <p id="sessionCode">C√≥digo: ${sessionId}</p>
            `;
            
            renderProducts();
            renderCategories();
            renderOrder();
            showScreen('sessionScreen');
        }

        function renderCategories() {
            const categories = ['all', ...new Set(appData.products.map(p => p.category))];
            const filterDiv = document.getElementById('categoryFilter');
            filterDiv.innerHTML = categories.map(cat => 
                `<div class="category-btn ${cat === currentFilter ? 'active' : ''}" onclick="filterByCategory('${cat}')">
                    ${cat === 'all' ? 'Todos' : cat}
                </div>`
            ).join('');
        }

        function filterByCategory(category) {
            currentFilter = category;
            renderCategories();
            renderProducts();
        }

        function renderProducts() {
            const grid = document.getElementById('productGrid');
            const filteredProducts = currentFilter === 'all' 
                ? appData.products 
                : appData.products.filter(p => p.category === currentFilter);

            grid.innerHTML = filteredProducts.map(product => {
                const iconHtml = product.icon.startsWith('data:image') 
                    ? `<img src="${product.icon}" style="width: 50px; height: 50px; object-fit: contain; border-radius: 8px;">`
                    : product.icon;
                
                return `
                    <div class="product-item" onclick="addToOrder(${product.id})">
                        <div class="product-img">${iconHtml}</div>
                        <div class="product-name">${product.name}</div>
                    </div>
                `;
            }).join('');
        }

        function addToOrder(productId) {
            const session = appData.sessions[appData.currentSession];
            if (!session.items[productId]) {
                session.items[productId] = 1;
            } else {
                session.items[productId]++;
            }
            saveSessions(); // Guardar cambios
            renderOrder();
        }

        function updateQuantity(productId, change) {
            const session = appData.sessions[appData.currentSession];
            if (!session.items[productId]) return;

            session.items[productId] += change;
            if (session.items[productId] <= 0) {
                delete session.items[productId];
            }
            saveSessions(); // Guardar cambios
            renderOrder();
        }

        function renderOrder() {
            const session = appData.sessions[appData.currentSession];
            const orderList = document.getElementById('orderList');
            
            const items = Object.entries(session.items);
            if (items.length === 0) {
                orderList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üõí</div>
                        <p>No hay productos en el pedido</p>
                    </div>
                `;
                document.getElementById('totalAmount').textContent = '0';
                return;
            }
            
            let totalItems = 0;
            orderList.innerHTML = items.map(([productId, quantity]) => {
                const product = appData.products.find(p => p.id == productId);
                if (!product) return '';

                totalItems += quantity;

                const iconHtml = product.icon.startsWith('data:image') 
                    ? `<img src="${product.icon}" style="width: 24px; height: 24px; object-fit: contain; margin-right: 8px; border-radius: 4px; vertical-align: middle;">`
                    : product.icon + ' ';

                return `
                    <div class="order-item">
                        <div class="order-item-info">
                            <div class="order-item-name">${iconHtml}${product.name}</div>
                            <div class="order-item-price">Cantidad: ${quantity}</div>
                        </div>
                        <div class="order-item-controls">
                            <button class="quantity-btn" onclick="updateQuantity(${productId}, -1)">‚àí</button>
                            <div class="quantity">${quantity}</div>
                            <button class="quantity-btn" onclick="updateQuantity(${productId}, 1)">+</button>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('totalAmount').textContent = totalItems;
        }

        function closeSession() {
            if (!confirm('¬øCerrar esta cuenta? Los datos quedar√°n guardados pero no se podr√° acceder de nuevo.')) return;
            
            const session = appData.sessions[appData.currentSession];
            session.isActive = false;
            saveSessions(); // Guardar cambios
            appData.currentSession = null;
            showMain();
        }

        function leaveSession() {
            if (confirm('¬øSalir de esta cuenta?')) {
                appData.currentSession = null;
                showMain();
            }
        }

        function showSummary() {
            const session = appData.sessions[appData.currentSession];
            if (!session) return;

            document.getElementById('summarySessionName').textContent = session.name;

            // Agrupar productos por categor√≠a
            const categories = {};
            let total = 0;

            Object.entries(session.items).forEach(([productId, quantity]) => {
                const product = appData.products.find(p => p.id == productId);
                if (!product) return;

                if (!categories[product.category]) {
                    categories[product.category] = [];
                }

                categories[product.category].push({
                    name: product.name,
                    icon: product.icon,
                    quantity: quantity
                });

                total += quantity;
            });

            // Renderizar resumen
            let summaryHtml = '';

            Object.keys(categories).sort().forEach(category => {
                summaryHtml += `
                    <div class="summary-category">
                        <div class="summary-category-title">${category}</div>
                `;

                categories[category].forEach(item => {
                    const iconHtml = item.icon.startsWith('data:image')
                        ? `<img src="${item.icon}" style="width: 24px; height: 24px; object-fit: contain; margin-right: 8px; vertical-align: middle;">`
                        : item.icon + ' ';

                    summaryHtml += `
                        <div class="summary-item">
                            <div class="summary-item-name">${iconHtml}${item.name}</div>
                            <div class="summary-item-qty">√ó${item.quantity}</div>
                        </div>
                    `;
                });

                summaryHtml += '</div>';
            });

            document.getElementById('summaryContent').innerHTML = summaryHtml;
            document.getElementById('summaryTotal').textContent = total;

            showScreen('summaryScreen');
        }

        function backToSession() {
            if (appData.currentSession) {
                loadSession(appData.currentSession);
            }
        }

        function printSummary() {
            window.print();
        }

        function renderSummaryList() {
            const session = appData.sessions[appData.currentSession];
            const summaryList = document.getElementById('summaryList');
            
            const items = Object.entries(session.items);
            if (items.length === 0) {
                summaryList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üõí</div>
                        <p>No hay productos en esta cuenta</p>
                    </div>
                `;
                document.getElementById('summaryTotal').textContent = '0';
                return;
            }

            // Agrupar productos por categor√≠a
            const productsByCategory = {};
            let totalItems = 0;

            items.forEach(([productId, quantity]) => {
                const product = appData.products.find(p => p.id == productId);
                if (!product) return;

                if (!productsByCategory[product.category]) {
                    productsByCategory[product.category] = [];
                }
                productsByCategory[product.category].push({
                    name: product.name,
                    icon: product.icon,
                    quantity: quantity
                });
                totalItems += quantity;
            });

            // Renderizar por categor√≠as
            let html = '';
            Object.keys(productsByCategory).sort().forEach(category => {
                html += `
                    <div style="margin-bottom: 24px;">
                        <h4 style="color: var(--color-primary); margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid var(--color-border);">
                            ${category}
                        </h4>
                `;
                
                productsByCategory[category].forEach(item => {
                    const iconHtml = item.icon.startsWith('data:image') 
                        ? `<img src="${item.icon}" style="width: 28px; height: 28px; object-fit: contain; margin-right: 12px; border-radius: 4px;">`
                        : `<span style="font-size: 28px; margin-right: 12px;">${item.icon}</span>`;
                    
                    html += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--color-bg-secondary); border-radius: 8px; margin-bottom: 8px;">
                            <div style="display: flex; align-items: center; flex: 1;">
                                ${iconHtml}
                                <span style="font-size: 16px; font-weight: 600;">${item.name}</span>
                            </div>
                            <div style="font-size: 24px; font-weight: 700; color: var(--color-primary); min-width: 60px; text-align: right;">
                                ${item.quantity}
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
            });

            summaryList.innerHTML = html;
            document.getElementById('summaryTotal').textContent = totalItems;
        }

        function renderSessionList() {
            const list = document.getElementById('sessionList');
            const sessions = Object.values(appData.sessions).filter(s => s.isActive);
            
            if (sessions.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <p>No hay cuentas activas</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = sessions.map(session => `
                <div class="session-card" onclick="loadSession('${session.id}')">
                    <div class="session-header">
                        <div class="session-name">${session.name}</div>
                        <div class="session-status">Activa</div>
                    </div>
                    <div class="session-info">
                        C√≥digo: ${session.id} ‚Ä¢ ${new Date(session.createdAt).toLocaleDateString('es-ES')}
                    </div>
                </div>
            `).join('');
        }

        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            const errorDiv = document.getElementById('adminError');
            
            if (password === appData.adminPassword) {
                renderAdminScreen();
                showScreen('adminScreen');
            } else {
                errorDiv.innerHTML = '<div class="alert alert-error">Contrase√±a incorrecta</div>';
            }
        }

        function renderAdminScreen() {
            renderIconPicker();
            renderProductAdminList();
        }

        function renderIconPicker() {
            const picker = document.getElementById('iconPicker');
            picker.innerHTML = icons.map(icon => 
                `<div class="icon-option" onclick="selectIcon('${icon}')">${icon}</div>`
            ).join('');
        }

        function selectIcon(icon) {
            const selectedIconDiv = document.getElementById('selectedIcon');
            selectedIconDiv.innerHTML = icon;
            document.querySelectorAll('.icon-option').forEach(el => el.classList.remove('selected'));
            if (event && event.target) {
                event.target.classList.add('selected');
            }
        }

        function showEmojiPicker() {
            document.getElementById('iconPickerContainer').style.display = 'block';
            document.getElementById('imageUploadContainer').style.display = 'none';
        }

        function showImageUpload() {
            document.getElementById('iconPickerContainer').style.display = 'none';
            document.getElementById('imageUploadContainer').style.display = 'block';
            
            const imageInput = document.getElementById('imageUpload');
            imageInput.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const maxSize = 100;
                        let width = img.width;
                        let height = img.height;
                        
                        if (width > height) {
                            if (width > maxSize) {
                                height *= maxSize / width;
                                width = maxSize;
                            }
                        } else {
                            if (height > maxSize) {
                                width *= maxSize / height;
                                height = maxSize;
                            }
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        const dataUrl = canvas.toDataURL('image/png');
                        document.getElementById('selectedIcon').innerHTML = 
                            `<img src="${dataUrl}" style="width: 50px; height: 50px; object-fit: contain; border-radius: 8px;">`;
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            };
        }

        function addProduct() {
            const name = document.getElementById('productName').value.trim();
            const category = document.getElementById('productCategory').value.trim();
            const iconElement = document.getElementById('selectedIcon');
            const imgTag = iconElement.querySelector('img');
            const icon = imgTag ? imgTag.src : iconElement.textContent;

            if (!name || !category) {
                alert('Por favor, completa todos los campos correctamente');
                return;
            }

            const newId = Math.max(...appData.products.map(p => p.id), 0) + 1;
            appData.products.push({
                id: newId,
                name: name,
                icon: icon,
                category: category
            });

            // Guardar en localStorage
            localStorage.setItem('azeri_products', JSON.stringify(appData.products));

            document.getElementById('productName').value = '';
            document.getElementById('productCategory').value = '';
            document.getElementById('selectedIcon').innerHTML = 'üç∫';
            document.getElementById('imageUpload').value = '';
            document.getElementById('iconPickerContainer').style.display = 'block';
            document.getElementById('imageUploadContainer').style.display = 'none';
            document.getElementById('productSuccess').innerHTML = '<div class="alert alert-success">Producto a√±adido correctamente</div>';
            
            setTimeout(() => {
                document.getElementById('productSuccess').innerHTML = '';
            }, 3000);

            renderProductAdminList();
        }

        function deleteProduct(productId) {
            if (!confirm('¬øEliminar este producto?')) return;
            
            const index = appData.products.findIndex(p => p.id === productId);
            if (index !== -1) {
                appData.products.splice(index, 1);
                // Guardar en localStorage
                localStorage.setItem('azeri_products', JSON.stringify(appData.products));
                renderProductAdminList();
            }
        }

        function renderProductAdminList() {
            const list = document.getElementById('productAdminList');
            if (appData.products.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>No hay productos</p></div>';
                return;
            }

            list.innerHTML = appData.products.map(product => {
                const iconHtml = product.icon.startsWith('data:image') 
                    ? `<img src="${product.icon}" style="width: 30px; height: 30px; object-fit: contain; margin-right: 8px; border-radius: 4px;">`
                    : `<span style="font-size: 24px; margin-right: 8px;">${product.icon}</span>`;
                
                return `
                    <div class="product-admin-item">
                        <div style="display: flex; align-items: center;">
                            ${iconHtml}
                            <strong>${product.name}</strong>
                            <span style="color: var(--color-text-muted); font-size: 14px;"> ‚Ä¢ ${product.category}</span>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-secondary btn-small" onclick="editProduct(${product.id})">‚úèÔ∏è Editar</button>
                            <button class="btn btn-danger btn-small" onclick="deleteProduct(${product.id})">üóëÔ∏è Eliminar</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function editProduct(productId) {
            const product = appData.products.find(p => p.id === productId);
            if (!product) return;

            // Rellenar el formulario con los datos del producto
            document.getElementById('productName').value = product.name;
            document.getElementById('productCategory').value = product.category;
            
            // Mostrar el icono actual
            if (product.icon.startsWith('data:image')) {
                document.getElementById('selectedIcon').innerHTML = 
                    `<img src="${product.icon}" style="width: 50px; height: 50px; object-fit: contain; border-radius: 8px;">`;
                showImageUpload();
            } else {
                document.getElementById('selectedIcon').innerHTML = product.icon;
                showEmojiPicker();
            }

            // Cambiar el bot√≥n de guardar a modo edici√≥n
            const saveBtn = document.querySelector('.admin-section:nth-child(2) .btn-success');
            saveBtn.textContent = 'üíæ Actualizar Producto';
            saveBtn.onclick = function() { updateProduct(productId); };

            // Scroll al formulario
            document.querySelector('.admin-section:nth-child(2)').scrollIntoView({ behavior: 'smooth' });
        }

        function updateProduct(productId) {
            const name = document.getElementById('productName').value.trim();
            const category = document.getElementById('productCategory').value.trim();
            const iconElement = document.getElementById('selectedIcon');
            const imgTag = iconElement.querySelector('img');
            const icon = imgTag ? imgTag.src : iconElement.textContent;

            if (!name || !category) {
                alert('Por favor, completa todos los campos correctamente');
                return;
            }

            const product = appData.products.find(p => p.id === productId);
            if (product) {
                product.name = name;
                product.category = category;
                product.icon = icon;

                // Guardar en localStorage
                localStorage.setItem('azeri_products', JSON.stringify(appData.products));

                // Resetear formulario
                document.getElementById('productName').value = '';
                document.getElementById('productCategory').value = '';
                document.getElementById('selectedIcon').innerHTML = 'üç∫';
                document.getElementById('imageUpload').value = '';
                
                // Restaurar bot√≥n a modo creaci√≥n
                const saveBtn = document.querySelector('.admin-section:nth-child(2) .btn-success');
                saveBtn.textContent = 'Guardar Producto';
                saveBtn.onclick = addProduct;

                document.getElementById('productSuccess').innerHTML = '<div class="alert alert-success">Producto actualizado correctamente</div>';
                
                setTimeout(() => {
                    document.getElementById('productSuccess').innerHTML = '';
                }, 3000);

                renderProductAdminList();
            }
        }

        function changePassword() {
            const newPassword = document.getElementById('newPassword').value;
            if (newPassword.length < 6) {
                alert('La contrase√±a debe tener al menos 6 caracteres');
                return;
            }

            appData.adminPassword = newPassword;
            document.getElementById('newPassword').value = '';
            document.getElementById('passwordSuccess').innerHTML = '<div class="alert alert-success">Contrase√±a actualizada correctamente</div>';
            
            setTimeout(() => {
                document.getElementById('passwordSuccess').innerHTML = '';
            }, 3000);
        }

        function importExcel() {
            const fileInput = document.getElementById('excelFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Por favor, selecciona un archivo Excel');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                    // Borrar todos los productos anteriores
                    appData.products = [];

                    let imported = 0;

                    jsonData.forEach((row, index) => {
                        const name = row['Nombre'] || row['nombre'] || row['NOMBRE'];
                        const category = row['Familia'] || row['familia'] || row['FAMILIA'];

                        if (name && category) {
                            const icon = getSmartIcon(name.toString(), category.toString());
                            appData.products.push({
                                id: index + 1,
                                name: name.toString().trim(),
                                icon: icon,
                                category: category.toString().trim()
                            });
                            imported++;
                        }
                    });

                    // Guardar productos en localStorage para que persistan
                    localStorage.setItem('azeri_products', JSON.stringify(appData.products));

                    document.getElementById('importSuccess').innerHTML = 
                        `<div class="alert alert-success">‚úÖ ${imported} productos importados correctamente (productos anteriores eliminados)</div>`;
                    
                    setTimeout(() => {
                        document.getElementById('importSuccess').innerHTML = '';
                    }, 5000);

                    fileInput.value = '';
                    renderProductAdminList();

                } catch (error) {
                    document.getElementById('importSuccess').innerHTML = 
                        '<div class="alert alert-error">‚ùå Error al procesar el archivo. Verifica el formato.</div>';
                    console.error('Error:', error);
                }
            };

            reader.readAsArrayBuffer(file);
        }

        function getSmartIcon(productName, category) {
            const name = productName.toUpperCase();
            const cat = category.toUpperCase();
            
            if (name.includes('CERVEZA') || name.includes('MAHOU') || name.includes('ALHAMBRA')) return 'üç∫';
            if (name.includes('VINO TINTO') || name.includes('RIOJA') || name.includes('CRIANZA')) return 'üç∑';
            if (name.includes('VINO BLANCO') || name.includes('RUEDA')) return 'ü•Ç';
            if (name.includes('CAVA') || name.includes('CHAMPAGNE')) return 'üçæ';
            if (name.includes('AGUA')) return 'üíß';
            if (name.includes('COCA') || name.includes('COLA') || name.includes('REFRESCO')) return 'ü•§';
            if (name.includes('KAS') || name.includes('FANTA') || name.includes('SPRITE')) return 'ü•§';
            if (name.includes('TONICA') || name.includes('SCHWEPPES')) return 'ü•§';
            if (name.includes('BITTER') || name.includes('MARTINI') || name.includes('CINZANO')) return 'üç∏';
            if (name.includes('ACEITUNAS') || name.includes('OLIVA')) return 'ü´í';
            if (name.includes('WHISKY') || name.includes('WHISKEY')) return 'ü•É';
            if (name.includes('VODKA')) return 'üç∏';
            if (name.includes('RON')) return 'ü•É';
            if (name.includes('GINEBRA') || name.includes('GIN')) return 'üç∏';
            if (name.includes('PACHARAN') || name.includes('ANIS')) return 'ü•É';
            if (name.includes('COGNAC') || name.includes('BRANDY')) return 'ü•É';
            if (name.includes('CAFE') || name.includes('CARAJILLO')) return '‚òï';
            if (name.includes('TE') || name.includes('INFUSION')) return 'üçµ';
            if (name.includes('QUESO')) return 'üßÄ';
            if (name.includes('JAMON') || name.includes('IBERICO')) return 'ü•ì';
            if (name.includes('CHORIZO') || name.includes('SALCHICHON')) return 'üå≠';
            if (name.includes('BOCADILLO') || name.includes('SANDWICH')) return 'ü•ñ';
            if (name.includes('TORTILLA')) return 'üç≥';
            if (name.includes('PATATA') || name.includes('CROQUETA')) return 'ü•î';
            if (name.includes('PIMIENTO')) return 'üå∂Ô∏è';
            
            if (cat.includes('CERVEZA')) return 'üç∫';
            if (cat.includes('VINO') || cat.includes('SIDRA')) return 'üç∑';
            if (cat.includes('CAVA')) return 'üçæ';
            if (cat.includes('REFRESCO')) return 'ü•§';
            if (cat.includes('APERITIVO')) return 'üç∏';
            if (cat.includes('LICOR')) return 'ü•É';
            if (cat.includes('CAFE')) return '‚òï';
            if (cat.includes('COMIDA')) return 'üçΩÔ∏è';
            
            return icons[Math.floor(Math.random() * icons.length)];
        }

        function cleanExpiredSessions() {
            const now = new Date();
            let cleaned = false;
            Object.keys(appData.sessions).forEach(sessionId => {
                const session = appData.sessions[sessionId];
                const expiresAt = new Date(session.expiresAt);
                
                if (now > expiresAt) {
                    session.isActive = false;
                    delete appData.sessions[sessionId];
                    cleaned = true;
                }
            });
            if (cleaned) {
                saveSessions(); // Guardar cambios si se limpi√≥ algo
            }
        }

        // Inicializaci√≥n
        window.addEventListener('load', () => {
            // Cargar productos desde localStorage
            const savedProducts = localStorage.getItem('azeri_products');
            if (savedProducts) {
                try {
                    appData.products = JSON.parse(savedProducts);
                    console.log('‚úÖ Productos cargados:', appData.products.length);
                } catch (error) {
                    console.error('‚ùå Error al cargar productos:', error);
                }
            }

            // Cargar sesiones desde localStorage
            loadSessions();
            
            cleanExpiredSessions();
            
            setInterval(cleanExpiredSessions, 60000);
            
            const urlParams = new URLSearchParams(window.location.search);
            const sessionParam = urlParams.get('session');
            
            if (sessionParam && appData.sessions[sessionParam]) {
                document.getElementById('sessionId').value = sessionParam;
                showJoinSession();
            }

            // Mostrar estado de almacenamiento en consola
            console.log('üîç Estado del almacenamiento:');
            console.log('   - Productos:', appData.products.length);
            console.log('   - Sesiones activas:', Object.keys(appData.sessions).filter(k => appData.sessions[k].isActive).length);
            console.log('   - Sesiones totales:', Object.keys(appData.sessions).length);
        });
    </script>
</body>
</html>
